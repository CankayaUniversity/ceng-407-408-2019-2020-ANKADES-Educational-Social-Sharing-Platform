{% extends 'ankades/layout/layout.html' %}
{% load static %}
{% block title %}{{ instance.title }}{% endblock %}
{% block content %}
    <div class="content-header mb-0">
        <div class="container">
            <div class="row">
                <div class="col-sm-12">
                    <p style="font-size: 2em !important;" class="text-center">{{ instance.title }}</p>
                </div>
            </div>
        </div>
    </div>
    <section class="content mt-0">
        <div class="container">
            <div class="row">
                <div class="card-widget mt-3 col-lg-12">
                    <div class="container-fluid" style="width: 100% !important;">
                        {% if instance.media != "no-image-available.png" %}
                            <img class="img-fluid pad" src="{{ instance.media.url }}" alt="{{ instance.title }}"
                                 width="100%" style="max-height: 800px !important;">
                        {% endif %}
                        <div class="container-fluid mt-5">
                            {{ instance.description|safe }}
                            <p>
                                <i style="color: #57a4ff" class="fa fa-ticket-alt"> {{ instance.categoryId.title }}</i>
                            </p>
                        </div>
                        <div class="row container-fluid" style="width: 100% !important;">
                            <div class="user-block">
                                <img class="img-circle" src="{{ instance.creator.image.url }}"
                                     alt="{{ instance.creator.get_full_name }}">
                                <span class="username"><a
                                        href="{% url 'account_detail' instance.creator %}">{{ instance.creator.get_full_name }}</a></span>
                                <span class="description">Paylaşım tarihi - {{ instance.createdDate }}</span>
                            </div>
                        </div>
                            <div class="row">
                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 mt-3">
                                    <button type="button" class="btn btn-danger btn-sm"><i class="fas fa-share"></i>
                                        Paylaş
                                    </button>
                                    <a type="button" data-href='{{ instance.get_api_like_url }}'
                                       data-likes='{{ instance.likes.count }}' href='{{ instance.get_like_url }}'
                                       class="btn btn-primary btn-sm"><i class="far fa-thumbs-up"></i> Beğen
                                    </a>
                                    {% if instance.creator == request.user or userGroup == 'admin' or userGroup == 'moderator' %}
                                        <a class="btn btn-info btn-sm"
                                           href="{% url 'edit_article' instance.slug %}">
                                            <i class="fas fa-pencil-alt">
                                            </i>
                                            Düzenle
                                        </a>
                                        <a class="btn btn-danger btn-sm"
                                           href="{% url 'delete_article' instance.slug %}">
                                            <i class="fas fa-pencil-alt">
                                            </i>
                                            Sil
                                        </a>
                                    {% endif %}
                                    {% if instance.creator != request.user %}
                                        <a type="button" class="btn btn-warning btn-sm" data-toggle="modal"
                                           data-target="#modal-default" style="color: white;">
                                            Şikayet Et
                                        </a>
                                    {% endif %}
                                </div>
                            <div class="row">
                                <div class="col-md-4 col-sm-6 col-12 mt-5">
                                    <div class="info-box">
                                        <span class="info-box-icon bg-danger"><i class="far fa-thumbs-up"></i></span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">Toplam Beğeni</span>
                                            <span class="info-box-number">{{ instance.likes.count }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-6 col-12 mt-5">
                                    <div class="info-box">
                                        <span class="info-box-icon bg-primary"><i class="far fa-eye"></i></span>

                                        <div class="info-box-content">
                                            <span class="info-box-text">Toplam Gösterim</span>
                                            <span class="info-box-number">{{ instance.view }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-6 col-12 mt-5">
                                    <div class="info-box">
                                        <span class="info-box-icon bg-success"><i class="far fa-comments"></i></span>

                                        <div class="info-box-content">
                                            <span class="info-box-text">Yorum Sayısı</span>
                                            <span class="info-box-number">{{ articleComments.count }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="container-fluid">
                            <form method="post" class="comment-form"
                                  action="{% url 'add_article_comment' slug=instance.slug %}">
                                {% csrf_token %}
                                <p class="comment-form-comment form-group has-placeholder">
                                    <label for="content">Bir Cevap Yaz</label>
                                    <i class="fa fa-edit color-main"></i>
                                    <textarea class="form-control" id="content" name="content"
                                              cols="45"
                                              rows="3" maxlength="65525" aria-required="true"
                                              required="required" placeholder=""></textarea>
                                </p>
                                <p class="form-submit">
                                    <button type="submit" class="btn btn-primary">
                                        <span>Gönder</span>
                                    </button>
                                </p>
                            </form>
                        </div>
                        {% if articleComments %}
                            <h4 class="comments-title mb-3">
                                Cevaplar
                            </h4>
                            {% for comment in articleComments %}
                                <div class="timeline">
                                    <div>
                                        <i class="fas fa-comment bg-blue"></i>
                                        <div class="timeline-item p-2">
                                            <img class="img-circle img-sm" src="{{ comment.creator.image.url }}"
                                                 alt="{{ comment.creator.get_full_name }}">
                                            <span class="time"><i
                                                    class="fas fa-clock"></i> {{ comment.createdDate }}</span>
                                            <h3 class="timeline-header ml-2 no-border"><a
                                                    href="{% url 'account_detail' comment.creator %}">{{ comment.creator.get_full_name }}</a>
                                            </h3>
                                            <div class="timeline-body">
                                                {{ comment.content }}
                                            </div>
                                            <div class="timeline-footer">
                                                <a class="btn btn-info btn-sm"
                                                   onclick="reply_{{ comment.commentNumber }}()"><i
                                                        class="fas fa-reply"></i>
                                                    Cevapla</a>
                                                {% if reply.creator == request.user or instance.creator == request.user or userGroup == "admin" or userGroup == "moderator" %}
                                                    <a onclick="edit_{{ comment.commentNumber }}()"
                                                       class="btn btn-success btn-sm">
                                                        <i class="fas fa-pencil-alt"></i>
                                                        Düzenle
                                                    </a>
                                                    <a href="{% url 'delete_article_comment' comment.commentNumber %}"
                                                       class="btn btn-danger btn-sm">
                                                        <i class="fas fa-trash"></i>
                                                        Sil
                                                    </a>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="timeline" id="{{ forloop.counter }}comment" style="display:none;">
                                        <div class="timeline-item">
                                            <form method="post" class="comment-form p-3"
                                                  action="{% url 'add_article_comment_reply' comment.commentNumber %}">
                                                {% csrf_token %}
                                                <p class="comment-form-comment form-group has-placeholder">
                                                    <label>Yanıt ver</label>
                                                    <i class="fa fa-edit color-main"></i>
                                                    <textarea class="form-control" name="reply"
                                                              cols="10"
                                                              rows="3" maxlength="65525" aria-required="true"
                                                              required="required" placeholder=""></textarea>
                                                </p>
                                                <p class="form-submit">
                                                    <button type="submit" class="btn btn-primary">
                                                        <span>Gönder</span>
                                                    </button>
                                                </p>
                                            </form>
                                        </div>
                                    </div>
                                    <div class="timeline" id="edit_{{ forloop.counter }}comment" style="display:none;">
                                        <div class="timeline-item">
                                            <form method="post" class="comment-form p-3"
                                                  action="{% url 'edit_article_comment' comment.commentNumber %}">
                                                {% csrf_token %}
                                                <p class="comment-form-comment form-group has-placeholder">
                                                    <label>Yorum Düzenle</label>
                                                    <i class="fa fa-edit color-main"></i>
                                                    <textarea class="form-control" name="edit"
                                                              cols="10"
                                                              rows="3" maxlength="65525" aria-required="true"
                                                              required="required"
                                                              placeholder="">{{ comment.content }}</textarea>
                                                </p>
                                                <p class="form-submit">
                                                    <button type="submit" class="btn btn-primary">
                                                        <span>Düzenle</span>
                                                    </button>
                                                </p>
                                            </form>
                                        </div>
                                    </div>
                                    {% if replyComment %}
                                        {% for reply in replyComment %}
                                            {% if reply.parentId_id == comment.id %}
                                                <div>
                                                    <div class="timeline-item p-2"
                                                         style="background-color: #f8f9fa !important; border:none; box-shadow: none;">
                                                        <img class="img-circle img-sm"
                                                             src="{{ reply.creator.image.url }}"
                                                             alt="{{ reply.creator.get_full_name }}">
                                                        <span class="time"><i
                                                                class="fas fa-clock"></i> {{ reply.createdDate }}</span>
                                                        <h3 class="timeline-header"><a
                                                                href="#">{{ reply.creator.get_full_name }}</a></h3>
                                                        <div class="timeline-body">
                                                            {{ reply.content }}
                                                        </div>
                                                        <div class="timeline-footer">
                                                            {% if reply.creator == request.user or instance.creator == request.user or userGroup == "admin" or userGroup == "moderator" %}
                                                                <a onclick="edit_reply_{{ reply.commentNumber }}()"
                                                                   class="btn btn-success btn-sm">
                                                                    <i class="fas fa-pencil-alt"></i>
                                                                    Düzenle
                                                                </a>
                                                                <a href="{% url 'delete_article_comment' reply.commentNumber %}"
                                                                   class="btn btn-danger btn-sm"><i
                                                                        class="fas fa-trash"></i> Sil</a>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            {% endif %}
                                            {#                                            edit reply#}
                                            <div class="timeline" id="edit_{{ forloop.counter }}reply"
                                                 style="display:none;">
                                                <div class="timeline-item">
                                                    <form method="post" class="comment-form p-3"
                                                          action="{% url 'edit_article_comment' reply.commentNumber %}">
                                                        {% csrf_token %}
                                                        <p class="comment-form-comment form-group has-placeholder">
                                                            <label>Yorum Düzenle</label>
                                                            <i class="fa fa-edit color-main"></i>
                                                            <textarea class="form-control" name="edit"
                                                                      cols="10"
                                                                      rows="3" maxlength="65525" aria-required="true"
                                                                      required="required"
                                                                      placeholder="">{{ reply.content }}</textarea>
                                                        </p>
                                                        <p class="form-submit">
                                                            <button type="submit" class="btn btn-primary">
                                                                <span>Düzenle</span>
                                                            </button>
                                                        </p>
                                                    </form>
                                                </div>
                                            </div>
                                            <script>
                                                function edit_reply_{{ reply.commentNumber }}() {
                                                    let open = document.getElementById("edit_{{ forloop.counter }}reply");
                                                    if (open.style.display === "none") {
                                                        open.style.display = "block";
                                                    } else {
                                                        open.style.display = "none";
                                                    }
                                                }
                                            </script>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                                <script>
                                    function reply_{{ comment.commentNumber }}() {
                                        let open = document.getElementById("{{ forloop.counter }}comment");
                                        if (open.style.display === "none") {
                                            open.style.display = "block";
                                        } else {
                                            open.style.display = "none";
                                        }
                                    }

                                    function edit_{{ comment.commentNumber }}() {
                                        let open = document.getElementById("edit_{{ forloop.counter }}comment");
                                        if (open.style.display === "none") {
                                            open.style.display = "block";
                                        } else {
                                            open.style.display = "none";
                                        }
                                    }
                                </script>
                            {% endfor %}
                        {% else %}
                            <h4 class="comments-title mb-3">
                                Cevaplar
                            </h4>
                            <div class="callout callout-danger col-lg-12 col-sm-12 col-xs-12 col-md-12">
                                <p>Herhangi bir cevap bulunamadı. İlk cevabı sen vermek ister misin ?</p>
                            </div>
                        {% endif %}
                    </div>
                    <div class="modal fade" id="modal-default">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4 class="modal-title">Şikayet Et</h4>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form role="form" method="post"
                                          action="{% url 'add_report_article' postNumber=instance.postNumber %}">
                                        {% csrf_token %}
                                        <div class="card-body">
                                            <div class="form-group">
                                                <select id="select" class="form-control select2bs4" style="width: 100%;"
                                                        value="Seçiniz" name="subjectId"
                                                        required>
                                                    <option disabled>Lütfen birini seçiniz</option>
                                                    {% if reportSubjects %}
                                                        {% for report in reportSubjects %}
                                                            {% if report.title != 'Home' %}
                                                                <option value="{{ report.id }}">{{ report.title }}</option>
                                                            {% endif %}
                                                        {% endfor %}
                                                    {% endif %}
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="message">Mesajınız*</label>
                                                <textarea class="form-control" name="description" id="message" rows="3"
                                                          maxlength="65525" aria-required="true" required
                                                          placeholder="Mesajınız"></textarea>
                                            </div>
                                        </div>
                                        <div class="card-footer">
                                            <button type="submit" name="submit" class="btn btn-primary">Gönder</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}
